<Window x:Class="LegoClickerCS.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Lego Clicker Loader"
        Width="300" Height="240"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
    ResizeMode="NoResize"
        WindowStartupLocation="CenterScreen">
    
    <Border Background="{DynamicResource BgBrush}" CornerRadius="14" 
            BorderBrush="{DynamicResource PanelBrush}" BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="30"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Title Bar -->
            <Border Grid.Row="0" Background="{DynamicResource PanelBrush}" CornerRadius="14,14,0,0" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <TextBlock Text="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=Title}" Foreground="{DynamicResource TextBrush}" 
                               FontFamily="Segoe UI" FontSize="14" FontWeight="SemiBold"
                               VerticalAlignment="Center" Margin="12,0,0,0"/>
                    <Button x:Name="CloseButton" Content="Ã—" 
                            HorizontalAlignment="Right" Width="30" Height="30"
                            Background="Transparent" Foreground="{DynamicResource DimTextBrush}"
                            BorderThickness="0" FontSize="18" FontWeight="Light"
                            Click="CloseButton_Click" Cursor="Hand">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" CornerRadius="0,14,0,0">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#E81123"/>
                                        <Setter Property="Foreground" Value="White"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
            </Border>
            
            <!-- Content Panel -->
            <Grid Grid.Row="1" Margin="20">

                <!-- Minimal loader (default / 1.8.9) -->
                <StackPanel x:Name="LoaderPanel" VerticalAlignment="Center">
                
                <TextBlock Text="Injection Control" Foreground="{DynamicResource TextBrush}" 
                           FontSize="16" FontWeight="Bold" Margin="0,0,0,10" HorizontalAlignment="Center"/>
                <TextBlock Text="Supported versions: 1.8.9 and 1.21.11 (auto-detected)"
                           Foreground="{DynamicResource DimTextBrush}"
                           FontSize="11" HorizontalAlignment="Center" Margin="0,0,0,10"/>

                <Button x:Name="InjectButton" Content="Inject / Connect" Height="35"
                        Style="{StaticResource DarkButton}" Click="InjectButton_Click"
                        FontSize="14" Margin="0,0,0,10" Cursor="Hand">
                 <Button.Effect>
                        <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
                    </Button.Effect>
                </Button>

                <TextBlock x:Name="InjectionStatusText" 
                           Text="Status: Not Injected" 
                           Foreground="{DynamicResource DimTextBrush}" 
                           FontSize="12" HorizontalAlignment="Center"/>
                <ProgressBar x:Name="InjectionProgressBar"
                             Minimum="0"
                             Maximum="100"
                             Height="6"
                             Margin="0,8,0,0"
                             Visibility="Collapsed"/>
                            
                </StackPanel>

                <!-- 1.21 control center (shown after connect) -->
                <ScrollViewer x:Name="ControlPanel" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Click modules -->
                        <StackPanel Grid.Column="0" Margin="0,0,8,0">
                            <TextBlock Text="Click Modules" Foreground="{DynamicResource TextBrush}"
                                       FontSize="16" FontWeight="Bold" Margin="0,0,0,8"/>

                            <Border Background="{DynamicResource PanelBrush}" CornerRadius="12" Padding="12" Margin="0,0,0,12">
                                <StackPanel>
                                    <CheckBox Content="AutoClicker" IsChecked="{Binding IsArmed, Mode=OneWay}" Style="{StaticResource ModuleSwitch}" Click="ToggleArmed_Click"/>
                                    <TextBlock Text="{Binding StatusText}" Foreground="{DynamicResource AccentBrush}" FontSize="12" Margin="0,4,0,10" />

                                    <DockPanel>
                                        <TextBlock Text="Min CPS" Foreground="{DynamicResource TextBrush}" FontSize="12" DockPanel.Dock="Left" />
                                        <TextBlock Text="{Binding MinCPS, StringFormat={}{0:0}}" Foreground="{DynamicResource DimTextBrush}" FontSize="12" HorizontalAlignment="Right" DockPanel.Dock="Right" />
                                    </DockPanel>
                                    <Slider Minimum="1" Maximum="25" Value="{Binding MinCPS, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource DarkSlider}"/>

                                    <DockPanel Margin="0,6,0,0">
                                        <TextBlock Text="Max CPS" Foreground="{DynamicResource TextBrush}" FontSize="12" DockPanel.Dock="Left" />
                                        <TextBlock Text="{Binding MaxCPS, StringFormat={}{0:0}}" Foreground="{DynamicResource DimTextBrush}" FontSize="12" HorizontalAlignment="Right" DockPanel.Dock="Right" />
                                    </DockPanel>
                                    <Slider Minimum="1" Maximum="25" Value="{Binding MaxCPS, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource DarkSlider}"/>

                                    <WrapPanel Margin="0,10,0,0">
                                        <CheckBox Content="Jitter" IsChecked="{Binding JitterEnabled, Mode=TwoWay}" Style="{StaticResource DarkCheckBox}" Margin="0,0,14,0"/>
                                        <CheckBox Content="Click in Chests" IsChecked="{Binding ClickInChests, Mode=TwoWay}" Style="{StaticResource DarkCheckBox}" Margin="0,0,14,0"/>
                                        <CheckBox Content="Pause when breaking" IsChecked="{Binding BreakBlocksEnabled, Mode=TwoWay}" Style="{StaticResource DarkCheckBox}"/>
                                    </WrapPanel>
                                </StackPanel>
                            </Border>

                            <Border Background="{DynamicResource PanelBrush}" CornerRadius="12" Padding="12">
                                <StackPanel>
                                    <TextBlock Text="Right Click" Foreground="{DynamicResource TextBrush}" FontSize="16" FontWeight="Bold" />
                                    <CheckBox Content="Enable Right Click" IsChecked="{Binding RightClickEnabled, Mode=TwoWay}" Style="{StaticResource ModuleSwitch}" Margin="0,8,0,10"/>

                                    <DockPanel>
                                        <TextBlock Text="Right Min CPS" Foreground="{DynamicResource TextBrush}" FontSize="12" DockPanel.Dock="Left" />
                                        <TextBlock Text="{Binding RightMinCPS, StringFormat={}{0:0}}" Foreground="{DynamicResource DimTextBrush}" FontSize="12" HorizontalAlignment="Right" DockPanel.Dock="Right" />
                                    </DockPanel>
                                    <Slider Minimum="1" Maximum="25" Value="{Binding RightMinCPS, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource DarkSlider}"/>

                                    <DockPanel Margin="0,6,0,0">
                                        <TextBlock Text="Right Max CPS" Foreground="{DynamicResource TextBrush}" FontSize="12" DockPanel.Dock="Left" />
                                        <TextBlock Text="{Binding RightMaxCPS, StringFormat={}{0:0}}" Foreground="{DynamicResource DimTextBrush}" FontSize="12" HorizontalAlignment="Right" DockPanel.Dock="Right" />
                                    </DockPanel>
                                    <Slider Minimum="1" Maximum="25" Value="{Binding RightMaxCPS, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource DarkSlider}"/>

                                    <CheckBox Content="Only when holding block" IsChecked="{Binding RightClickOnlyBlock, Mode=TwoWay}" Style="{StaticResource DarkCheckBox}" Margin="0,10,0,0"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Render modules -->
                        <StackPanel Grid.Column="1" Margin="8,0,0,0">
                            <TextBlock Text="Render Modules" Foreground="{DynamicResource TextBrush}"
                                       FontSize="16" FontWeight="Bold" Margin="0,0,0,8"/>

                            <Border Background="{DynamicResource PanelBrush}" CornerRadius="12" Padding="12" Margin="0,0,0,12">
                                <StackPanel>
                                    <CheckBox Content="Nametags" IsChecked="{Binding NametagsEnabled, Mode=TwoWay}" Style="{StaticResource ModuleSwitch}"/>
                                    <WrapPanel Margin="0,10,0,0" IsEnabled="{Binding NametagsEnabled}">
                                        <CheckBox Content="Show Health" IsChecked="{Binding NametagShowHealth, Mode=TwoWay}" Style="{StaticResource DarkCheckBox}" Margin="0,0,14,0"/>
                                        <CheckBox Content="Show Armor" IsChecked="{Binding NametagShowArmor, Mode=TwoWay}" Style="{StaticResource DarkCheckBox}" Margin="0,0,14,0"/>
                                        <CheckBox Content="Show Item" IsChecked="{Binding NametagShowHeldItem, Mode=TwoWay}" Style="{StaticResource DarkCheckBox}" />
                                    </WrapPanel>
                                    <DockPanel Margin="0,10,0,0" IsEnabled="{Binding NametagsEnabled}">
                                        <TextBlock Text="Nametag Count" Foreground="{DynamicResource TextBrush}" FontSize="12" DockPanel.Dock="Left" />
                                        <TextBlock Text="{Binding NametagMaxCount}" Foreground="{DynamicResource DimTextBrush}" FontSize="12" HorizontalAlignment="Right" DockPanel.Dock="Right" />
                                    </DockPanel>
                                    <Slider Minimum="1" Maximum="20" TickFrequency="1" IsSnapToTickEnabled="True"
                                            Value="{Binding NametagMaxCount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Style="{StaticResource DarkSlider}" IsEnabled="{Binding NametagsEnabled}"/>
                                </StackPanel>
                            </Border>

                            <Border Background="{DynamicResource PanelBrush}" CornerRadius="12" Padding="12" Margin="0,0,0,12">
                                <StackPanel>
                                    <CheckBox Content="Chest ESP" IsChecked="{Binding ChestEspEnabled, Mode=TwoWay}" Style="{StaticResource ModuleSwitch}"/>
                                    <DockPanel Margin="0,10,0,0" IsEnabled="{Binding ChestEspEnabled}">
                                        <TextBlock Text="Chest Count" Foreground="{DynamicResource TextBrush}" FontSize="12" DockPanel.Dock="Left" />
                                        <TextBlock Text="{Binding ChestEspMaxCount}" Foreground="{DynamicResource DimTextBrush}" FontSize="12" HorizontalAlignment="Right" DockPanel.Dock="Right" />
                                    </DockPanel>
                                    <Slider Minimum="1" Maximum="20" TickFrequency="1" IsSnapToTickEnabled="True"
                                            Value="{Binding ChestEspMaxCount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Style="{StaticResource DarkSlider}" IsEnabled="{Binding ChestEspEnabled}"/>
                                </StackPanel>
                            </Border>

                            <Border Background="{DynamicResource PanelBrush}" CornerRadius="12" Padding="12">
                                <StackPanel>
                                    <CheckBox Content="Closest Player" IsChecked="{Binding ClosestPlayerInfoEnabled, Mode=TwoWay}" Style="{StaticResource ModuleSwitch}"/>
                                    <TextBlock Text="Includes 4-way direction arrow (^, v, &lt;, &gt;)." Foreground="{DynamicResource DimTextBrush}" FontSize="12" Margin="0,8,0,0"/>
                                </StackPanel>
                            </Border>

                            <Border Background="{DynamicResource PanelBrush}" CornerRadius="12" Padding="12" Margin="0,12,0,0">
                                <StackPanel>
                                    <TextBlock Text="Module Keybinds" Foreground="{DynamicResource TextBrush}" FontSize="16" FontWeight="Bold"/>
                                    <TextBlock Text="Click a button, then press a key (Esc = unbind)." Foreground="{DynamicResource DimTextBrush}" FontSize="12" Margin="0,4,0,10"/>
                                    <WrapPanel>
                                        <Button x:Name="KeybindAutoclickerButton" Tag="autoclicker" Click="KeybindButton_Click" Style="{StaticResource DarkButton}" Margin="0,0,8,8" Width="170"/>
                                        <Button x:Name="KeybindRightClickButton" Tag="rightclick" Click="KeybindButton_Click" Style="{StaticResource DarkButton}" Margin="0,0,8,8" Width="170"/>
                                        <Button x:Name="KeybindJitterButton" Tag="jitter" Click="KeybindButton_Click" Style="{StaticResource DarkButton}" Margin="0,0,8,8" Width="170"/>
                                        <Button x:Name="KeybindClickInChestsButton" Tag="clickinchests" Click="KeybindButton_Click" Style="{StaticResource DarkButton}" Margin="0,0,8,8" Width="170"/>
                                        <Button x:Name="KeybindBreakBlocksButton" Tag="breakblocks" Click="KeybindButton_Click" Style="{StaticResource DarkButton}" Margin="0,0,8,8" Width="170"/>
                                        <Button x:Name="KeybindNametagsButton" Tag="nametags" Click="KeybindButton_Click" Style="{StaticResource DarkButton}" Margin="0,0,8,8" Width="170"/>
                                        <Button x:Name="KeybindChestEspButton" Tag="chestesp" Click="KeybindButton_Click" Style="{StaticResource DarkButton}" Margin="0,0,8,8" Width="170"/>
                                        <Button x:Name="KeybindClosestPlayerButton" Tag="closestplayer" Click="KeybindButton_Click" Style="{StaticResource DarkButton}" Margin="0,0,8,8" Width="170"/>
                                    </WrapPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>
                </ScrollViewer>

            </Grid>
        </Grid>
    </Border>
</Window>
